import { AmplifyUserError } from '@aws-amplify/platform-core';
import { NpmPackageManagerController } from './npm_package_manager_controller.js';
import { PnpmPackageManagerController } from './pnpm_package_manager_controller.js';
import { YarnClassicPackageManagerController } from './yarn_classic_package_manager_controller.js';
import { YarnModernPackageManagerController } from './yarn_modern_package_manager_controller.js';
import { printer as _printer } from '../printer.js';
import { getPackageManagerName } from './get_package_manager_name.js';
/**
 * PackageManagerControllerFactory is a factory for an abstraction around package manager commands that are needed to initialize a project and install dependencies
 */
export class PackageManagerControllerFactory {
    cwd;
    printer;
    platform;
    /**
     * constructor
     * @param cwd - the root directory of the project
     */
    constructor(cwd = process.cwd(), printer = _printer, platform = process.platform) {
        this.cwd = cwd;
        this.printer = printer;
        this.platform = platform;
    }
    /**
     * Returns a singleton instance of a package manager controller derived from reading the npm_config_user_agent environment variable.
     */
    getPackageManagerController() {
        const packageManagerName = getPackageManagerName();
        switch (packageManagerName) {
            case 'npm':
                return new NpmPackageManagerController(this.cwd);
            case 'pnpm':
                if (this.platform === 'win32') {
                    const message = 'Amplify does not support PNPM on Windows.';
                    const details = 'Details: https://github.com/aws-amplify/amplify-backend/blob/main/packages/create-amplify/README.md';
                    throw new AmplifyUserError('UnsupportedPackageManagerError', {
                        message,
                        details,
                        resolution: 'Use a supported package manager for your OS',
                    });
                }
                return new PnpmPackageManagerController(this.cwd);
            case 'yarn-classic':
                return new YarnClassicPackageManagerController(this.cwd);
            case 'yarn-modern':
                return new YarnModernPackageManagerController(this.cwd, this.printer);
            default:
                throw new AmplifyUserError('UnsupportedPackageManagerError', {
                    message: `Package Manager ${packageManagerName} is not supported.`,
                    resolution: 'Use npm, yarn or pnpm.',
                });
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFja2FnZV9tYW5hZ2VyX2NvbnRyb2xsZXJfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wYWNrYWdlLW1hbmFnZXItY29udHJvbGxlci9wYWNrYWdlX21hbmFnZXJfY29udHJvbGxlcl9mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzlELE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQ3BGLE9BQU8sRUFBRSxtQ0FBbUMsRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBQ25HLE9BQU8sRUFBRSxrQ0FBa0MsRUFBRSxNQUFNLDZDQUE2QyxDQUFDO0FBQ2pHLE9BQU8sRUFBRSxPQUFPLElBQUksUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXBELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBRXRFOztHQUVHO0FBQ0gsTUFBTSxPQUFPLCtCQUErQjtJQU12QjtJQUNBO0lBQ0E7SUFQbkI7OztPQUdHO0lBQ0gsWUFDbUIsTUFBTSxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQ25CLFVBQW1CLFFBQVEsRUFDM0IsV0FBVyxPQUFPLENBQUMsUUFBUTtRQUYzQixRQUFHLEdBQUgsR0FBRyxDQUFnQjtRQUNuQixZQUFPLEdBQVAsT0FBTyxDQUFvQjtRQUMzQixhQUFRLEdBQVIsUUFBUSxDQUFtQjtJQUMzQyxDQUFDO0lBRUo7O09BRUc7SUFDSCwyQkFBMkI7UUFDekIsTUFBTSxrQkFBa0IsR0FBRyxxQkFBcUIsRUFBRSxDQUFDO1FBQ25ELFFBQVEsa0JBQWtCLEVBQUU7WUFDMUIsS0FBSyxLQUFLO2dCQUNSLE9BQU8sSUFBSSwyQkFBMkIsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbkQsS0FBSyxNQUFNO2dCQUNULElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxPQUFPLEVBQUU7b0JBQzdCLE1BQU0sT0FBTyxHQUFHLDJDQUEyQyxDQUFDO29CQUM1RCxNQUFNLE9BQU8sR0FDWCxxR0FBcUcsQ0FBQztvQkFDeEcsTUFBTSxJQUFJLGdCQUFnQixDQUFDLGdDQUFnQyxFQUFFO3dCQUMzRCxPQUFPO3dCQUNQLE9BQU87d0JBQ1AsVUFBVSxFQUFFLDZDQUE2QztxQkFDMUQsQ0FBQyxDQUFDO2lCQUNKO2dCQUNELE9BQU8sSUFBSSw0QkFBNEIsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDcEQsS0FBSyxjQUFjO2dCQUNqQixPQUFPLElBQUksbUNBQW1DLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzNELEtBQUssYUFBYTtnQkFDaEIsT0FBTyxJQUFJLGtDQUFrQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3hFO2dCQUNFLE1BQU0sSUFBSSxnQkFBZ0IsQ0FBQyxnQ0FBZ0MsRUFBRTtvQkFDM0QsT0FBTyxFQUFFLG1CQUFtQixrQkFBa0Isb0JBQW9CO29CQUNsRSxVQUFVLEVBQUUsd0JBQXdCO2lCQUNyQyxDQUFDLENBQUM7U0FDTjtJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHR5cGUgUGFja2FnZU1hbmFnZXJDb250cm9sbGVyIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsdWdpbi10eXBlcyc7XG5pbXBvcnQgeyBBbXBsaWZ5VXNlckVycm9yIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsYXRmb3JtLWNvcmUnO1xuaW1wb3J0IHsgTnBtUGFja2FnZU1hbmFnZXJDb250cm9sbGVyIH0gZnJvbSAnLi9ucG1fcGFja2FnZV9tYW5hZ2VyX2NvbnRyb2xsZXIuanMnO1xuaW1wb3J0IHsgUG5wbVBhY2thZ2VNYW5hZ2VyQ29udHJvbGxlciB9IGZyb20gJy4vcG5wbV9wYWNrYWdlX21hbmFnZXJfY29udHJvbGxlci5qcyc7XG5pbXBvcnQgeyBZYXJuQ2xhc3NpY1BhY2thZ2VNYW5hZ2VyQ29udHJvbGxlciB9IGZyb20gJy4veWFybl9jbGFzc2ljX3BhY2thZ2VfbWFuYWdlcl9jb250cm9sbGVyLmpzJztcbmltcG9ydCB7IFlhcm5Nb2Rlcm5QYWNrYWdlTWFuYWdlckNvbnRyb2xsZXIgfSBmcm9tICcuL3lhcm5fbW9kZXJuX3BhY2thZ2VfbWFuYWdlcl9jb250cm9sbGVyLmpzJztcbmltcG9ydCB7IHByaW50ZXIgYXMgX3ByaW50ZXIgfSBmcm9tICcuLi9wcmludGVyLmpzJztcbmltcG9ydCB7IFByaW50ZXIgfSBmcm9tICcuLi9wcmludGVyL3ByaW50ZXIuanMnO1xuaW1wb3J0IHsgZ2V0UGFja2FnZU1hbmFnZXJOYW1lIH0gZnJvbSAnLi9nZXRfcGFja2FnZV9tYW5hZ2VyX25hbWUuanMnO1xuXG4vKipcbiAqIFBhY2thZ2VNYW5hZ2VyQ29udHJvbGxlckZhY3RvcnkgaXMgYSBmYWN0b3J5IGZvciBhbiBhYnN0cmFjdGlvbiBhcm91bmQgcGFja2FnZSBtYW5hZ2VyIGNvbW1hbmRzIHRoYXQgYXJlIG5lZWRlZCB0byBpbml0aWFsaXplIGEgcHJvamVjdCBhbmQgaW5zdGFsbCBkZXBlbmRlbmNpZXNcbiAqL1xuZXhwb3J0IGNsYXNzIFBhY2thZ2VNYW5hZ2VyQ29udHJvbGxlckZhY3Rvcnkge1xuICAvKipcbiAgICogY29uc3RydWN0b3JcbiAgICogQHBhcmFtIGN3ZCAtIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGUgcHJvamVjdFxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBjd2QgPSBwcm9jZXNzLmN3ZCgpLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJpbnRlcjogUHJpbnRlciA9IF9wcmludGVyLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcGxhdGZvcm0gPSBwcm9jZXNzLnBsYXRmb3JtLFxuICApIHt9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBzaW5nbGV0b24gaW5zdGFuY2Ugb2YgYSBwYWNrYWdlIG1hbmFnZXIgY29udHJvbGxlciBkZXJpdmVkIGZyb20gcmVhZGluZyB0aGUgbnBtX2NvbmZpZ191c2VyX2FnZW50IGVudmlyb25tZW50IHZhcmlhYmxlLlxuICAgKi9cbiAgZ2V0UGFja2FnZU1hbmFnZXJDb250cm9sbGVyKCk6IFBhY2thZ2VNYW5hZ2VyQ29udHJvbGxlciB7XG4gICAgY29uc3QgcGFja2FnZU1hbmFnZXJOYW1lID0gZ2V0UGFja2FnZU1hbmFnZXJOYW1lKCk7XG4gICAgc3dpdGNoIChwYWNrYWdlTWFuYWdlck5hbWUpIHtcbiAgICAgIGNhc2UgJ25wbSc6XG4gICAgICAgIHJldHVybiBuZXcgTnBtUGFja2FnZU1hbmFnZXJDb250cm9sbGVyKHRoaXMuY3dkKTtcbiAgICAgIGNhc2UgJ3BucG0nOlxuICAgICAgICBpZiAodGhpcy5wbGF0Zm9ybSA9PT0gJ3dpbjMyJykge1xuICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSAnQW1wbGlmeSBkb2VzIG5vdCBzdXBwb3J0IFBOUE0gb24gV2luZG93cy4nO1xuICAgICAgICAgIGNvbnN0IGRldGFpbHMgPVxuICAgICAgICAgICAgJ0RldGFpbHM6IGh0dHBzOi8vZ2l0aHViLmNvbS9hd3MtYW1wbGlmeS9hbXBsaWZ5LWJhY2tlbmQvYmxvYi9tYWluL3BhY2thZ2VzL2NyZWF0ZS1hbXBsaWZ5L1JFQURNRS5tZCc7XG4gICAgICAgICAgdGhyb3cgbmV3IEFtcGxpZnlVc2VyRXJyb3IoJ1Vuc3VwcG9ydGVkUGFja2FnZU1hbmFnZXJFcnJvcicsIHtcbiAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICBkZXRhaWxzLFxuICAgICAgICAgICAgcmVzb2x1dGlvbjogJ1VzZSBhIHN1cHBvcnRlZCBwYWNrYWdlIG1hbmFnZXIgZm9yIHlvdXIgT1MnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUG5wbVBhY2thZ2VNYW5hZ2VyQ29udHJvbGxlcih0aGlzLmN3ZCk7XG4gICAgICBjYXNlICd5YXJuLWNsYXNzaWMnOlxuICAgICAgICByZXR1cm4gbmV3IFlhcm5DbGFzc2ljUGFja2FnZU1hbmFnZXJDb250cm9sbGVyKHRoaXMuY3dkKTtcbiAgICAgIGNhc2UgJ3lhcm4tbW9kZXJuJzpcbiAgICAgICAgcmV0dXJuIG5ldyBZYXJuTW9kZXJuUGFja2FnZU1hbmFnZXJDb250cm9sbGVyKHRoaXMuY3dkLCB0aGlzLnByaW50ZXIpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEFtcGxpZnlVc2VyRXJyb3IoJ1Vuc3VwcG9ydGVkUGFja2FnZU1hbmFnZXJFcnJvcicsIHtcbiAgICAgICAgICBtZXNzYWdlOiBgUGFja2FnZSBNYW5hZ2VyICR7cGFja2FnZU1hbmFnZXJOYW1lfSBpcyBub3Qgc3VwcG9ydGVkLmAsXG4gICAgICAgICAgcmVzb2x1dGlvbjogJ1VzZSBucG0sIHlhcm4gb3IgcG5wbS4nLFxuICAgICAgICB9KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==